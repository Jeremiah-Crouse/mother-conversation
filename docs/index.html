<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE EVERYWHEN: MOBILE DRIFT</title>
    <style>
        :root {
            --bg: #050505;
            --terminal-green: #00ffcc;
            --fallback-red: #ff3300;
        }

        body {
            background-color: var(--bg);
            color: var(--terminal-green);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 15px;
            /* Use clamp to ensure text is never too small on mobile */
            font-size: clamp(14px, 4vw, 18px); 
            line-height: 1.5;
            overflow-x: hidden;
        }

        #status-bar {
            position: fixed;
            top: 0; left: 0; right: 0;
            background: rgba(10, 10, 10, 0.95);
            border-bottom: 1px solid #333;
            padding: 10px;
            font-size: 10px;
            display: flex;
            justify-content: space-between;
            z-index: 1000;
            text-transform: uppercase;
        }

        #output {
            margin-top: 40px;
            margin-bottom: 80px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        button {
            background: #1a1a1a;
            color: var(--terminal-green);
            border: 1px solid var(--terminal-green);
            padding: 12px 20px;
            font-family: inherit;
            font-size: 12px;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 4px;
        }

        button:active { background: var(--terminal-green); color: black; }

        .pseudo { color: var(--fallback-red); }
    </style>
</head>
<body>

    <div id="status-bar">
        <span id="source-display">INITIALIZING...</span>
        <span>T = âˆž</span>
    </div>

    <div id="output"></div>

    <div class="controls">
        <button id="toggle-btn">PAUSE</button>
        <button onclick="document.getElementById('output').innerHTML=''">CLEAR</button>
    </div>

    <script>
        const API_URL = "https://mother-conversation.onrender.com/invoke";
        const output = document.getElementById('output');
        const sourceDisplay = document.getElementById('source-display');
        const toggleBtn = document.getElementById('toggle-btn');
        
        let isPaused = false;

        toggleBtn.onclick = () => {
            isPaused = !isPaused;
            toggleBtn.innerText = isPaused ? "RESUME" : "PAUSE";
        };

        async function drift() {
            if (!isPaused) {
                try {
                    const res = await fetch(API_URL);
                    const data = await res.json();
                    
                    const span = document.createElement('span');
                    if (data.source.includes("LOCAL")) span.className = "pseudo";
                    span.innerText = data.token;
                    
                    output.appendChild(span);
                    sourceDisplay.innerText = data.source;

                    // Improved auto-scroll for mobile
                    window.scrollTo({
                        top: document.body.scrollHeight,
                        behavior: 'auto'
                    });
                } catch (e) {
                    sourceDisplay.innerText = "LOST CONNECTION";
                }
            }
            // 80ms is usually the sweet spot for mobile reading speed
            setTimeout(drift, 80);
        }

        drift();
    </script>
</body>
</html>